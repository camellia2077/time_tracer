## 0.4.0.0 - 2026-01-11


### 优化core结构

### 提取converter和importer共同数据结构

**目标**：消除 `converter`（生产者）和 `importer`（消费者）之间的数据定义冗余，建立统一的数据契约，降低维护成本。

#### **1. 新增公共模型 (`common`)**

* **文件**：创建了 `common/model/TimeDataModels.hpp`。
* **内容**：
* `struct ActivityStats`：统一了所有统计字段（如 `sleep_night_time`, `recreation_bilibili_time`），采用 **snake_case** 命名，与数据库列名直接对应。
* `struct BaseActivityRecord`：统一了基础活动记录字段（如 `logical_id`, `start_time_str`, `project_path`）。



#### **2. Converter 模块重构**

* **模型变更**：`InputData` 现在直接包含 `ActivityStats stats` 和 `std::vector<BaseActivityRecord> processedActivities`，删除了原有的 `GeneratedStats` 和 `Activity` 结构体。
* **逻辑适配**：
* 更新了 `DayStats` 和 `StatsRules`，适配新的 snake_case 字段名。
* 更新了 `ActivityMapper` 和 `DayProcessor`，使用 `BaseActivityRecord` 构建数据。
* 更新了 `Output` (JSON 生成)，字段键名与新模型保持一致。



#### **3. Importer 模块重构**

* **模型变更**：
* `DayData` 移除了十几个散落的 int 字段，改为包含一个 `ActivityStats stats` 成员。
* `TimeRecordInternal` 现在继承自 `BaseActivityRecord`，复用了大部分字段定义。


* **逻辑适配**：
* **内存解析 (`MemoryParser`)**：极大地简化了代码，利用结构体赋值（`day_data.stats = input_day.stats`）直接传递数据，不再需要逐字段拷贝。
* **JSON 解析 (`DayParser`, `ActivityParser`)**：适配了新的 JSON 结构和字段名。
* **数据库写入 (`Writer`)**：更新了 `sqlite3_bind` 逻辑，从嵌套的 `stats` 结构和基类中读取数据。



#### **本次更新的收益**

1. **单一数据源 (Single Source of Truth)**：新增统计字段（如阅读时间）只需在 `common` 中定义一次。
2. **代码简化**：`MemoryParser` 中的映射逻辑大幅减少。
3. **类型安全与规范**：统一使用 C++ 标准推荐的 snake_case 命名数据成员，消除了驼峰命名与数据库字段名之间的转换心智负担。
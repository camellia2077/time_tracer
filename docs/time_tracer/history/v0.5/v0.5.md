## [v0.5.5] - 2026-02-05
### Summary
新增 `tree` 命令用于可视化项目结构，优化静态分析构建环境（PCH 可配置开关），并完成大规模架构重构（构建系统模块化、Repository 模式、CLI 框架增强）以提升代码质量与可维护性。

## Added
* **项目树展示**：新增 `tree` 命令，支持以树形结构展示项目层级。
* **项目路径过滤**：支持指定 `PROJECT_PATH` 参数（如 `tree study`、`tree study_math`）只展示特定项目子树。
* **层级控制**：新增 `-l/--level` 参数控制树展示深度。
* **根列举**：新增 `-r/--roots` 参数列出所有顶层根项目。
* **命令帮助优化**：CLI 支持 `tree --help`（及其他命令）只显示单命令帮助而非全局帮助。

## Changed/Refactor
* **构建系统模块化**：彻底重构 CMake 配置，移除单体 `SourceFileCollection.cmake`，采用 Modern CMake 标准，为每个模块（domain, infra, application, cli, reports）建立独立的 `CMakeLists.txt`。
* **Repository 模式**：引入数据访问层，定义 `IProjectRepository` 接口并实现 `SqliteProjectRepository`，解耦业务逻辑与 SQL 实现。
* **CLI 框架清理**：将 `framework/io/console_input` 移至 `impl/io/`，确保 `framework/` 严格只包含命令解析核心（`CommandParser`、`ArgDef`、`CommandValidator` 等），与业务无关的通用基础设施。
* **CLI 框架增强**：
    - `CommandParser` 新增 `GetPositionalArgs(std::span<const ArgDef>)` 重载，根据参数定义智能跳过 Option 类型的值（如 `-l 2` 中的 `2`），正确提取位置参数。
    - 修复 `tree -l 2` 将 `2` 误识别为项目路径的问题。
* **分层架构优化**：
    - 将 `ReportFileManager` 从 Application 层下沉至 Infrastructure 层，解决循环依赖问题。
    - 重构 `ProjectTreeViewer`：Application 层只返回数据（`GetRoots()` → `std::vector<std::string>`，`GetTree()` → `std::optional<std::vector<ProjectTreeNode>>`），移除所有 `std::cout` 输出。
    - 新增 `TreeFormatter`（CLI 层）负责树形输出格式化，遵循"Application 层返回数据，CLI 层负责展示"的分层原则。
* **PCH 条件编译**：在 **`TargetSetup.cmake`** 中实现 `ENABLE_PCH` 开关，支持在静态分析等场景下禁用预编译头以获得更完备的头文件检查。
* **Main程序拆分**：将臃肿的 **`main_cli.cpp`** (>200行) 重构为三部分：
    - **`ConsoleHelper`** (`cli/impl/utils/`): 负责 Windows 控制台 UTF-8 设置与参数获取。
    - **`AppRunner`** (`cli/impl/app/`): 封装应用启动逻辑与环境校验。
    - **`main_cli.cpp`**: 仅保留极简的入口异常捕获。
* **ANSI 颜色重构**：将 ANSI 颜色定义从宏（如 `RED_COLOR`）迁移至命名空间常量（`time_tracer::common::colors`），提升代码质量与可维护性。

## Fixed
* **链接器问题**：修复静态库 (`time_tracker_cli_lib`) 中未引用符号（CLI 命令注册对象）被链接器丢弃导致命令丢失的问题（使用 `-Wl,--whole-archive`）。
* **Win32 DLL 缺失**：修复 MinGW/Clang 环境下 `libgcc`、`libstdc++` 等运行时库未完整复制导致的启动失败问题。
* **编译警告**：修复 `EscapeLike` 未使用的编译警告。
* **缺失头文件**：修复 **`arg_definitions.hpp`** 中因依赖 PCH 而缺失的 `#include <map>`。
* **Windows 头文件冲突**：修复 **`main_cli.cpp`** 中 `windows.h` 与 `shellapi.h` 的包含顺序问题。

## [v0.5.4] - 2026-02-01
### Summary
新增数据查询命令与批量聚合复用，完善 Windows 下中文查询参数处理。

## Added
* **数据查询命令**：新增 `query-data`，支持列出年份/月/日与按条件筛选日期（remark、project、exercise/status、overnight、year/month）。
* **日备注查询**：新增 `--day-remark`（别名 `--remark-day`）用于查询 `days.remark`。
* **范围与排序**：新增 `--from/--to`（支持 YYYY/ YYYYMM/ YYYYMMDD）、`-n/--numbers` 与 `-r/--reverse`。
* **文档**：新增 CLI 查询用法说明（`docs/time_tracer/cli-query-guide.md`）。

## Changed
* **Batch 聚合复用**：周/月/年/周期批量查询统一使用共享聚合 helper。
* **月度聚合一致性**：月报改用 `project_agg` 聚合结构与统一构建流程。
* **Windows 参数处理**：CLI 参数统一转 UTF-8，避免中文查询在 SQLite 中匹配失败。
* **项目路径查询**：`--project` 支持路径片段匹配，便于模糊查询。

## Fixed
* **中文查询失败**：修复 Windows 环境下中文命令行参数编码导致的备注查询失败问题。


## [v0.5.3] - 2026-02-01
### Summary
配置结构优化与样式复用支持，统一报表文案并稳定配置加载路径。

## Added
* **样式复用**：新增 `style_source` 合并机制，支持从公共样式 TOML 读取并覆盖。
* **公共样式文件**：新增 `reports/typst/common_style.toml` 与 `reports/latex/common_style.toml`。
* **CLI 默认配置**：新增 `[defaults]`（`db_path`/`output_root`/`default_format`）与 `[commands.*]` 默认项（如 `convert` 的 `date_check`/`save_processed_output`/`validate_logic`/`validate_structure`，`ingest` 与 `validate-logic` 的 `date_check`，以及 `export`/`query` 的 `format`）。

## Changed
* **配置目录重构**：报表配置按格式分组（`reports/markdown|latex|typst`），统一路径并简化层级。
* **文案一致性**：`total_time_label` 统一为 **Total Time Recorded**。
* **插件配置加载**：DLL 侧接收合并后的配置内容，确保 `style_source` 生效。
* **导入流程**：移除 `import` 命令的交互确认与相关配置项，导入流程不再提示确认。
* **配置验证输出**：验证成功时不再打印，仅在失败/异常时输出错误信息。
* **批量导出流程**：抽取导出公共流程，统一缓存加载与项目树构建入口。

## Fixed
* **In-memory 导入**：补齐 `getup_time` 写入，起床时间不再在日报中显示为 `N/A`。



## [v0.5.2] - 2026-01-31
### Summary
Add ISO 8601 week reports, Gregorian-year reports (explicitly calendar-year based), and document how to add new range-style reports.

## Added
* **Weekly reports (ISO 8601)**: Query/export/all-export support with `YYYY-Www` and Monday–Sunday range.
* **Yearly reports (Gregorian year)**: Query/export/all-export support with `YYYY` and Jan 1–Dec 31 range.
* **Guide**: New documentation for adding a range-style report using week as an example.

## Changed
* **Configs**: Week and year report configs added alongside day/month/period in app and test configs.
* **IO structure**: Consolidated `src/io` into `src/infrastructure/io` to unify the infrastructure layer.

## Fixed
* **Plugin exports**: Standardized formatter DLL exports to lowercase names (`create_formatter`, `destroy_formatter`, `format_report`) and kept legacy aliases to prevent runtime symbol lookup failures. Only export symbol names changed; functionality remains the same. Affected plugins: `libDayMdFormatter.dll`, `libDayTexFormatter.dll`, `libDayTypFormatter.dll`, `libRangeMdFormatter.dll`, `libRangeTexFormatter.dll`, `libRangeTypFormatter.dll`.


## [v0.5.1] - 2026-01-31

### 核心摘要
用ReportFileManager来取代month和recent原有的重复实现

## 重构 (Refactor)
* **输出文件夹一致性**：更新 **`ReportFileManager`** 以使用 `day` 和 `month` 子目录（取代原本的 `daily`、`monthly` 和 `days`）。
* **CLI 类型标准化**：将 `query` 和 `export` 命令中的 `daily`、`monthly` 和 `period` 类型更名为 `day`、`month` 和 `recent`。
* **统一导出命令**：将 `all-daily` 和 `all-monthly` 更名为 `all-day` 和 `all-month`。
* **历史记录重组**：将所有版本历史文件重新排序，遵循逆序排列原则（最新版本在前）。


## [v0.5.0] - 2026-01-30

### 核心摘要
引入application,改进输出命名与代码清理

## 重构 (Refactor)
* **架构演进**：引入 `domain/`、`application/` 及 `infrastructure/` 分层，明确职责边界。
* **目录瘦身**：彻底移除 `common/` 等过时的冗余模块，简化 `ConverterStep` 逻辑。

## 改进与变更 (Changed)
* **解析增强**：实现 Fail-fast 机制，确保解析错误能被实时捕获并中止转换流程。
* **CLI 标准化**：
    - `period` 指令更名为 `recent`。
    - `all-period` 指令更名为 `all-recent`。
* **输出规范**：统一导出目录名与报告文件名为小写格式。

## 修复 (Fixed)
* **内存安全**：修复了因 `std::unique_ptr` 前置声明及 `const &` 误用导致的潜在内存风险。
* **编译优化**：清理未使用的变量，消除编译器警告。

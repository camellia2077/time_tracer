# 输入文本格式与记录规则

本文描述 TimeTracer 的 `.txt` 原始日志格式、必需约束，以及
`@allow-long` 的使用规则。

## 1. 文件结构

- **年份头**: 必须以 `yYYYY` 形式出现，且**一个文件只能有一个年份头**。
  - 示例: `y2021`
- **月份头**: 必须以 `mMM` 形式紧随年份头出现（新建月文件默认写入）。
  - 示例: `m01`
- **日期行**: `MMDD` 四位数字。
  - **首日必须为当月 1 号**（例如 `0101`）。
- **日备注行**: 以 `remark_prefix` 开头（默认 `r `）。
  - 只能出现在日期行之后，且**必须在当天任何事件行之前**。
- **事件行**: `HHMM` + 活动描述。
  - 时间为 24 小时制，`00:00` ~ `23:59`。
  - 活动描述不能为空。
- **空行**: 会被忽略。

头部顺序约束:
- 必须先出现 `yYYYY`，再出现 `mMM`，之后才允许 `MMDD`/事件行。
- 同一文件最多允许一个 `mMM`。
- `mMM` 必须在 `m01..m12` 范围内。
- 若 `mMM` 与后续 `MMDD` 的月份前两位不一致，结构校验会报错。

## 2. 事件行与行内备注

事件行可以附带行内备注，分隔符支持 `//`、`#`、`;`。
程序会以**最先出现的分隔符**作为备注起点。

示例:
```
0747wake
0806meal
0809oral-hygiene #今天特殊情况
0813drive
```

## 3. `@allow-long` 标记

为了跳过“单个活动超过 16 小时即报错”的限制，可以在**事件行的行内备注**
里加入 `@allow-long`（顺序不敏感，只要备注里包含该 token 即生效）。

示例:
```
0756oral-hygiene #今天特殊情况 @allow-long
```

**注意**:
- `@allow-long` 只能写在**事件行的行内备注**中；
- 写在**日备注行**（`r ...`）里不会生效。

## 4. 逻辑校验要点 (当前实现)

- **活动时长必须 > 0**（`start_time == end_time` 视为错误）。
- **单个活动时长不得超过 16 小时**，除非事件备注包含 `@allow-long`。
- **每天至少 2 条活动**（用于保证睡眠等统计的合理性）。

## 5. 完整示例

```
y2021
m01
0101
r 今天写代码
0747wake
0806meal
0809oral-hygiene #今天特殊情况 @allow-long
0813book
```


# Time Tracer 设计理念

## 1. 设计目标

Time Tracer 的核心目标是：**以文本为中心管理时间记录**。  
用户应当可以直接阅读和修改原始记录文本，例如补充备注、修改活动名，再通过导入同步影响数据库与格式化报告。

换句话说，数据库是计算与查询层，文本才是用户可长期持有和维护的“源数据”。

## 2. 核心原则

### 2.1 文本优先（Text-First）

- 原始数据以 TXT 形式保存，结构简单、可读、可编辑。
- 用户可以像编辑记事本一样维护数据，不需要理解数据库结构。
- 一次修改文本，即可间接更新后续统计与报告输出。

### 2.2 跨平台兼容（Cross-Platform Compatibility）

- 系统不依赖特定 GUI。
- 在没有 App 的场景下，用户依然可以继续按文本格式记录。
- 后续在任意平台（CLI / Android / 其他）都可继续导入与处理同一份文本数据。

### 2.3 用户数据主权（Data Ownership）

- 用户持有的是可直接理解的文本，而不是仅能由应用解释的内部格式。
- 即使脱离 App，用户也能快速查看“每天做了什么”。
- 数据迁移、备份、审阅成本低。

### 2.4 可读性优先于嵌套结构

- 相比数据库导出的原始 JSON，TXT 更直观。
- JSON 往往存在多层嵌套，人工阅读与手工修改成本更高。
- TXT 格式更适合“先看懂，再修改”。

## 3. 数据流定位

推荐数据流：

`TXT（源数据） -> Ingest -> Database（查询/聚合） -> Report（Markdown 等）`

其中：

- TXT 负责记录与编辑体验。
- Database 负责高效查询与统计。
- Report 负责结构化展示结果。

## 4. 记录格式示例

```text
y2026

0201
r 守望先锋真好玩
0641新的一天开始了
0940有氧训练 //remark
1158白天睡觉 #备注
1453数据结构二叉树 ;apple
1535有氧训练 //banana
1919高等数学二重积分
2137白天睡觉
2335快递

0202
0656新的一天开始了
0941数据结构图 #cherry
1058cr ;date
1509守望先锋 //remark
1622睡觉 #备注
2009cr ;apple
2110无氧训练 //banana
2243守望先锋 #cherry


```

## 5. 总结

这个设计不是“用数据库替代文本”，而是“用数据库增强文本”。  
文本负责可读、可改、可迁移；数据库负责计算、查询与报告生成。

## 6. 使用路径与取舍

我希望最终的数据始终掌握在用户手里。  
因此，Time Tracer 采用了可直接编辑的文本格式，而不是要求用户依赖某个特定 App 才能读写自己的记录。

### 6.1 不安装软件：TXT + AI 也能用

- 即使不使用 Time Tracer，你也可以用手机自带文本工具按推荐格式记录。
- 然后把文本发给手机 AI 助手或其他 AI 工具，让它按“截止时间”估算各活动持续时长。
- 这种方式的优势是零安装成本；不足是计算结果可能存在误差，但通常在可接受范围内。

### 6.2 记录格式的来源与最简化原则

- 当前格式借鉴了 LRC 常见的“时间点 + 内容”结构。
- 区别在于：这里记录的是**截止时间**，不是开始时间。
- 在保留 `小时分钟（HHmm）` 与 `活动名` 的前提下，这个格式已经足够简洁，继续简化会明显损失可读性或可计算性。

### 6.3 需要更高准确性和分析能力：使用 App

- 如果希望获得更准确的时长计算、更稳定的同步流程、以及更多统计分析能力，建议使用 Time Tracer App。
- App 路径会把文本导入数据库，再生成结构化报告，准确性与一致性更高。

### 6.4 需要更多导出格式：使用 Windows 版本

- 如果需要更丰富的报告格式，建议使用 Windows 版本（支持 LaTeX 和 Typst）。
- 手机端不会实现 LaTeX/Typst PDF 编译链路：虽然文本生成本身不复杂，但移动端集成完整编译环境会显著增加体积和维护成本，尤其是 LaTeX，不符合手机端轻量化目标。

## 7. 系统设计落地（由理念到实现）

为避免“理念”和“实现”分裂，下面给出与前文一致的系统落地要点。

### 7.1 摄取流水线（Ingestion Pipeline）

- 输入源是原始 TXT。
- 解析流程采用管道式处理：`读取 -> 结构解析 -> 语义标准化 -> 持久化`。
- 目标是把“可读文本”稳定转换为“可查询数据”。

### 7.2 上下文锚点（年份/日期）

- 通过 `y2026` 这类年份锚点与 `MMDD` 日期锚点建立上下文。
- 事件行继承当前锚点，直到下一个锚点出现。
- 这样能保持输入简洁，同时保证解析时序一致。

### 7.3 语义标准化与动态分类

- 文本层允许别名、缩写和自然表达。
- 进入领域层后可做映射与标准化，形成统一分类路径。
- 分类结构可随数据动态增长，不强制用户先维护固定字典。

### 7.4 存储与报告

- 数据库负责查询、聚合与报告生成，不替代 TXT 作为源数据。
- 通过预聚合指标提升报表速度（尤其是日/周/月/年趋势）。
- 报告层可输出 Markdown；桌面端可扩展到更多格式。

### 7.5 校验与失败策略

- 解析过程分层校验：结构合法性、时间逻辑一致性、业务约束。
- 出现关键错误时采用快速失败（Fail-Fast），防止脏数据进入数据库。
- 这样可以保证后续统计与报告的可信度。

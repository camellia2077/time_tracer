## [v0.2.0] - 2026-02-24

### Breaking Change 同步（core rename）
1. Windows CLI 所依赖的 core 目录与工具链 app 名已同步切换为 `tracer_core`。
2. 文档中的构建/验证命令统一改为 `--app tracer_core`，不再保留 `--app time_tracer` 入口说明。

### 版本号升级
1. Windows CLI 版本统一升级到 `0.2.0`：
   - `apps/tracer_cli/windows/CMakeLists.txt`
   - `apps/tracer_cli/windows/src/api/cli/CMakeLists.txt`
   - `apps/tracer_cli/windows/src/api/cli/impl/app/version.hpp`
2. 版本来源收敛为单一 CMake 文件，避免多处手改：
   - 新增 `apps/tracer_cli/windows/cmake/Version.cmake`
   - 顶层 `project(... VERSION ...)` 改为读取该文件
   - CLI 编译宏 `TRACER_WINDOWS_CLI_VERSION` 改为复用 `${PROJECT_VERSION}`

### Report Chart HTML 导出职责拆分
1. 将 `query_command.cpp` 内的图表 HTML 导出实现迁移到独立表现层模块：
   - `apps/tracer_cli/windows/src/api/cli/impl/presentation/report_chart_html_exporter.hpp`
   - `apps/tracer_cli/windows/src/api/cli/impl/presentation/report_chart_html_exporter.cpp`
2. `query` 命令职责收敛为“参数解析 + core 调用 + 导出委托”，不再内嵌大段 HTML 组装逻辑。
3. `--chart-html-output` 行为保持不变：
   - 仅支持 `query data report-chart`
   - 自动将输出模式切到语义 JSON
   - 成功时输出 `Saved report-chart line HTML: ...`

### Report Chart HTML 导出升级（模板化 + 离线 ECharts）
1. HTML 生成从 C++ 长字符串拼接升级为模板文件渲染：
   - 公共壳模板：`apps/tracer_cli/windows/assets/templates/report_chart_base.html.tpl`
   - 图表脚本模板：
     - `apps/tracer_cli/windows/assets/templates/report_chart_option_line.js.tpl`
     - `apps/tracer_cli/windows/assets/templates/report_chart_option_bar.js.tpl`
     - `apps/tracer_cli/windows/assets/templates/report_chart_option_pie.js.tpl`
     - `apps/tracer_cli/windows/assets/templates/report_chart_option_heatmap_year.js.tpl`
     - `apps/tracer_cli/windows/assets/templates/report_chart_option_heatmap_month.js.tpl`
   - 导出器读取模板并注入 payload/展示字段：`apps/tracer_cli/windows/src/api/cli/impl/presentation/report_chart_html_exporter.cpp`
2. 图表渲染脚本从运行时 CDN 改为 vendored 本地资源，并在导出时内嵌进单文件 HTML：
   - vendored 脚本：`apps/tracer_cli/windows/assets/vendor/echarts/echarts.min.js`
   - 版本与来源记录：`apps/tracer_cli/windows/assets/vendor/echarts/VENDOR.md`
3. 构建与运行时布局新增 `assets` 分发，确保 CLI 与 runtime/workspace 场景都可离线导出：
   - `apps/tracer_cli/windows/CMakeLists.txt`
   - `apps/tracer_cli/windows/cmake/StageRuntimeLayout.cmake`
   - `test/suites/tracer_windows_cli/env.toml`
4. 行为变化：
   - `--chart-html-output` 命令参数与输出路径约定不变。
   - 导出的 HTML 不再依赖网络 CDN，离线打开可渲染图表。

### Report Chart 类型扩展（Line / Bar / Pie）
1. `query data report-chart` 导出新增 `--chart-type`：
   - `--chart-type line|bar|pie`
   - 未指定时默认 `line`
2. 三种类型均复用同一份 core `report-chart` payload，不新增统计口径。
3. 命令层新增参数校验：
   - 非法值会报错（仅允许 `line/bar/pie`）
   - `--chart-type` 需配合 `--chart-html-output` 使用
4. 成功输出提示改为按类型区分：
   - `Saved report-chart line HTML: ...`
   - `Saved report-chart bar HTML: ...`
   - `Saved report-chart pie HTML: ...`

### Report Chart 热力图主题扩展（GitHub Style）
1. `query data report-chart --chart-html-output` 新增主题参数：
   - `--chart-theme default|github`
   - 默认值为 `default`
2. `github` 主题用于热力图（`heatmap-year` / `heatmap-month`）配色切换：
   - 调整为 GitHub contribution 风格梯度色带。
3. 模板与导出器支持主题注入：
   - `apps/tracer_cli/windows/assets/templates/report_chart_base.html.tpl`
   - `apps/tracer_cli/windows/src/api/cli/impl/presentation/report_chart_html_exporter.cpp`
4. 参数约束：
   - `--chart-theme` 仅支持 `query data report-chart`。
   - `--chart-theme` 需与 `--chart-html-output` 配合使用。

### Crypto 命令职责拆分（为进度显示做准备）
1. `crypto` 命令从“单文件大实现”拆分为命令层 + 交互层 + 执行层 + 进度表现层：
   - 命令层（保留注册与参数入口）：
     - `apps/tracer_cli/windows/src/api/cli/impl/commands/crypto/crypto_command.cpp`
   - 密码输入交互：
     - `apps/tracer_cli/windows/src/api/cli/impl/commands/crypto/crypto_passphrase_io.hpp`
     - `apps/tracer_cli/windows/src/api/cli/impl/commands/crypto/crypto_passphrase_io.cpp`
   - 加密/解密/检查执行流程：
     - `apps/tracer_cli/windows/src/api/cli/impl/commands/crypto/crypto_file_runner.hpp`
     - `apps/tracer_cli/windows/src/api/cli/impl/commands/crypto/crypto_file_runner.cpp`
   - 进度渲染骨架（后续单行刷新实现入口）：
     - `apps/tracer_cli/windows/src/api/cli/impl/presentation/progress/crypto_progress_renderer.hpp`
     - `apps/tracer_cli/windows/src/api/cli/impl/presentation/progress/crypto_progress_renderer.cpp`
2. 行为兼容性：
   - `crypto encrypt|decrypt|inspect` 的参数与业务行为保持不变。
   - 已支持单行刷新进度输出；非 TTY / 不支持 ANSI 终端自动降级为文本百分比模式。
3. 构建同步：
   - 新增源文件已注册到 `apps/tracer_cli/windows/src/api/cli/CMakeLists.txt`。
4. 重构收益：
   - `crypto_command.cpp` 职责收敛到命令入口（`Execute/GetHelp/GetDefinitions/Register`），为后续进度展示与终端兼容性改造降低变更风险。

### Crypto 进度显示手工验证记录（2026-02-26）
1. 验证环境与构建：
   - `cmake --build "apps/tracer_cli/windows/build_fast" --config Debug`
2. 验证命令（成功路径，非 TTY 降级输出）：
   - `demo-passphrase\ndemo-passphrase | time_tracer_cli crypto encrypt --in "temp/manual_crypto_progress_case_20260226/input" --out "temp/manual_crypto_progress_case_20260226/encrypted"`
   - 观察到进度文本按阶段输出，包含 `overall/group/file` 三层信息。
3. 验证命令（失败路径，错误口令解密）：
   - `wrong-passphrase | time_tracer_cli crypto decrypt --in "temp/manual_crypto_progress_case_20260226/encrypted/2025/2025-01.tracer" --out "temp/manual_crypto_progress_case_20260226/decrypted_fail"`
   - 观察到终态行：`phase: failed | status: failed`，随后命令以错误退出。
4. 验证结论：
   - 非交互场景（stdin 管道）已验证会退化为逐行文本百分比输出。
   - 可交互终端单行刷新由 `DetectOutputMode` 分支策略控制（TTY + VT 模式）。
   - 失败终态输出明确，便于日志检索与人工排障。

### 构建与回归
1. CMake 已接入新模块：
   - `apps/tracer_cli/windows/src/api/cli/CMakeLists.txt`
2. 回归验证：
   - `python scripts/run.py post-change --app tracer_windows_cli`
   - 结果：`Total: 150, Failed: 0`
3. `report-chart` HTML 导出断言已同步更新为 ECharts 内嵌路径验证：
   - `test/suites/tracer_windows_cli/tests/commands_query_data.toml`

### MinGW `std::print` 链接结论快照（2026-02-24）
1. 本版本确认：`std::format` 可在不链接 `-lstdc++exp` 的情况下通过。
2. 本版本确认：`std::print/std::println` 仍需 `-lstdc++exp`，否则链接报 `std::__open_terminal` / `std::__write_to_terminal` 未定义。
3. 该结论为工具链时点结论，详细复现与复查策略记录在：
   - `docs/time_tracer/guides/build_guide.md` 的 `MinGW std::print / stdc++exp 兼容性结论（2026-02-24）`。


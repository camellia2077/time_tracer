## [v0.1.0] - 2026-02-14

### 新增功能 (Added)

* 新增单仓 `apps/tracer_android`（Jetpack Compose + JNI）宿主工程，打通最小调用链
* 补齐 Android 宿主工程与资源目录（配置、smoke/full 测试数据）
* 新增 Markdown 报告查询入口：`day/month/year/week/recent`
* 新增 Report 的 `Range` 模式（Markdown 输出）
* 新增 `Record` 录入页与原始 TXT 历史查看能力
* 新增独立 `TXT` Tab（从 Record 页剥离查看/编辑）
* 新增按月切换能力：支持 `Prev/Next`，目标月不存在时可自动创建
* 新增 Record 页"单文件式"月切换与按月写入流程
* 新增 Markdown 渲染 Report 的内容
* 新增 Record 增加活动命名建议
* 新增 `Config` 页外观设置卡片，支持实时切换主题色与深浅模式
* 新增 "Use Wallpaper Colors" 开关（Android 12+ 壁纸主题色适配）
* 新增 Report 页 `Data Analysis` 区块：可直接调用 C++ `query data days-stats` 与 `query data tree`
* 新增 Tree 查询参数：支持 `period` 下拉、`periodArgument` 输入与 `level` 输入（`-1` 无限深度）
* **参数语义映射表（UI 输入 -> JNI -> C++ Query）**：
  | 场景 | UI 输入来源 | ViewModel 参数 | JNI `nativeQuery` | C++ `DataQueryRequest` | CLI 对照 |
  |---|---|---|---|---|---|
  | Stats (day) | `Stats Day` 分段输入 `YYYY/MM/DD` | `period=day`, `periodArgument=YYYYMMDD` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="day"`, `treePeriodArgument="YYYYMMDD"` | `action=kDaysStats`, `tree_period="day"`, `tree_period_argument="YYYYMMDD"` | `query data days-stats --period day --period-arg YYYYMMDD` |
  | Stats (week) | `Stats Week` 分段输入 `YYYY/WW` | `period=week`, `periodArgument=YYYY-WW` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="week"`, `treePeriodArgument="YYYY-WW"` | `action=kDaysStats`, `tree_period="week"`, `tree_period_argument="YYYY-WW"` | `query data days-stats --period week --period-arg YYYY-WW` |
  | Stats (month) | `Stats Month` 分段输入 `YYYY/MM` | `period=month`, `periodArgument=YYYYMM` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="month"`, `treePeriodArgument="YYYYMM"` | `action=kDaysStats`, `tree_period="month"`, `tree_period_argument="YYYYMM"` | `query data days-stats --period month --period-arg YYYYMM` |
  | Stats (year) | `Stats Year` 输入 `YYYY` | `period=year`, `periodArgument=YYYY` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="year"`, `treePeriodArgument="YYYY"` | `action=kDaysStats`, `tree_period="year"`, `tree_period_argument="YYYY"` | `query data days-stats --period year --period-arg YYYY` |
  | Stats (recent) | `Stats Recent Days (N)` | `period=recent`, `periodArgument=N` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="recent"`, `treePeriodArgument="N"` | `action=kDaysStats`, `tree_period="recent"`, `tree_period_argument="N"` | `query data days-stats --period recent --period-arg N` |
  | Stats (range) | `Stats Start Date` + `Stats End Date` | `period=range`, `periodArgument=YYYY-MM-DD\|YYYY-MM-DD` | `action=QUERY_ACTION_DAYS_STATS`, `treePeriod="range"`, `treePeriodArgument="start\|end"` | `action=kDaysStats`, `tree_period="range"`, `tree_period_argument="start\|end"` | `query data days-stats --period range --period-arg start\|end` |
  | Tree (all periods) | `Tree Period` + 对应参数 + `Tree Level` | `period=*`, `periodArgument=*`, `level` | `action=QUERY_ACTION_TREE`, `treePeriod`, `treePeriodArgument`, `treeMaxDepth` | `action=kTree`, `tree_period`, `tree_period_argument`, `tree_max_depth` | `query data tree --period ... --period-arg ... --level ...` |
  > 说明：`week` 在 UI 端使用纯数字分段输入（`YYYY` 与 `WW`），提交前归一化为 `YYYY-WW`；`range` 在 UI 端使用两组分段日期输入，提交前归一化为 `YYYY-MM-DD|YYYY-MM-DD`。

### 技术改进/重构 (Changed/Refactor)

* 重构 Android 侧配置为 TOML（与 Windows 一致），并加入 smoke/full 数据入口与清库按钮
* 迁移 Android UI 状态到每个 Screen 对应 **ViewModel**，并完成按职责目录分层（`ui/` / `runtime/` / `bridge/`）
* 收敛 Android 架构为 `Feature + Contract + Runtime`，由 `:app` 统一组装依赖（**TracerApplication** + **AppContainer**）
* 重构模块依赖：
  * 新增 `:contract` 模块承载 **RuntimeGateway** 与对外 DTO
  * `:feature-data` / `:feature-report` / `:feature-record` 从依赖 `:runtime` 改为依赖 `:contract`
  * `:runtime` 收口为实现层并统一错误出口，不向 feature 抛实现异常
  * `:app` 通过 **TracerApplication** + **AppContainer** 固定组装入口
* 重构 Android 启动路径：
  * 将 `assets/time_tracer/**` 复制到 `filesDir/time_tracer/**`
  * 使用 `converter/config/interval_processor_config.toml` 调用 `nativeInit(...)`
* 重构 Android UI 现代化（Material3 + Jetpack Compose）：
  * 主题重构：移除默认 Purple，统一使用 `Slate/Indigo` 专业配色
  * **RecordScreen** 引入 `Card` 分组时间与内容，优化表单体验
  * **TracerScreen** 底部导航栏图标化，移除首页调试头信息
* 新增深色模式主题：Lavender / Peach / Mint / Gold / Cyan / Teal / Terra Cotta / Violet / Pink / Sakura
* 新增 **DataStore** 持久化存储，提供 Slate / Emerald / Rose / Sky 四色主题与深色模式切换
* 优化 **RecordScreen** 时间刷新机制，增加操作反馈与图标引导
* 统一 `:feature-data` / `:feature-report` / `:feature-record` 的代码结构与依赖管理
* 重构 Config 页 About 区的 Core Version 为 `0.6.1`
* 重构 Android 页面结构拆分为 Tab：
  * `Data`：`Init Native` / `Ingest Smoke` / `Ingest Full` / `Clear App Data`
  * `Query/Report`：`Query Smoke` + `Report Day/Month/Year/Week/Recent MD`
  * `Record`：`Record Current Time (Auto Sync DB)` / `Refresh TXT History` / `Open <file>` / `Save TXT (Auto Sync DB)`
  * `Data` 页不显示查询/报告输出，仅 `Query/Report` 页显示 Markdown 结果
* 重构 Android 报告查询输入参数约定（MD）：
  * Day: `YYYY-MM-DD`
  * Month: `YYYY-MM`
  * Year: `YYYY`
  * Week: `YYYY-Www`
* 重构 Android 报告查询展示策略：
  * `ok=true` 仅展示 `content`（Markdown 原文）
  * `ok=false` 仅展示 `error_message`
* 重构 Android Debug UI 操作按钮：
  * `Init Native` / `Query Smoke` / `Ingest Smoke` / `Ingest Full`
  * `Report Day MD` / `Report Month MD` / `Report Year MD` / `Report Week MD` / `Report Recent MD`
  * `Clear App Data`（删除 `filesDir/time_tracer` 后自动重新初始化）
  * `Record Current Time`（按本机时间写入 live TXT）
  * `Record Current Time` 与 `Save TXT` 均自动触发数据库同步（移除独立 `Sync To Database` 按钮）
  * `Refresh TXT History`（刷新 live TXT 文件列表）
  * `Open <file>`（查看某个原始 TXT 文件内容）
* 重构 Android 原始 TXT 历史管理（live 目录）：
  * `NativeRuntimeController.listLiveTxtFiles()`：列出 `filesDir/time_tracer/input/live/**.txt`
  * `NativeRuntimeController.readLiveTxtFile(relativePath)`：读取指定 TXT 内容并做越界路径保护
  * `NativeRuntimeController.saveLiveTxtFileAndSync(...)`：保存编辑后的 TXT 并自动同步数据库
* 重构 ViewModel 分层：
  * `apps/tracer_android/feature-data/.../DataViewModel.kt`
  * `apps/tracer_android/feature-report/.../QueryReportViewModel.kt`
  * `apps/tracer_android/feature-record/.../RecordViewModel.kt`
* 重构 Screen 仅负责 Compose 视图拼装与事件分发：
  * `apps/tracer_android/feature-data/.../DataScreen.kt`
  * `apps/tracer_android/feature-report/.../QueryReportScreen.kt`
  * `apps/tracer_android/feature-record/.../RecordScreen.kt`
  * `apps/tracer_android/app/.../TracerScreen.kt`
* 重构 Runtime/Bridge 职责目录化：
  * `apps/tracer_android/runtime/.../runtime/**`
  * `apps/tracer_android/runtime/.../bridge/**`
* 扩展 Android Runtime/Bridge 查询协议（复用 C++ data query）：
  * **RuntimeGateway** 新增 `queryDayDurations` / `queryDayDurationStats` / `queryProjectTree`
  * `NativeBridge.nativeQuery(...)` 扩展 `treePeriod` / `treePeriodArgument` / `treeMaxDepth` 三个参数
  * **NativeRuntimeController** 新增统一 `runDataQuery(...)` 内部通路
* 扩展 **QueryReportViewModel** 分析状态：
  * 新增 `dayStatsOutput` / `treeOutput` / `analysisLoading` / `analysisError`
  * 新增事件 `loadDayStats(topN?)` / `loadTree(period, periodArgument, level)`
* 拆分 Report 页结果展示为 `Report Result` / `Day Stats Result` / `Tree Result`，并增加 `Analysis Error` 卡片
* **P1 Step 1-8 接口拆分迁移清单**：
  * 已完成基线校验（构建 + runtime 测试）：
    * `cd apps/tracer_android && ./gradlew.bat :app:assembleDebug`
    * `ctest --test-dir apps/time_tracer/build_fast -R "^time_tracker_android_runtime_tests$" --output-on-failure`
  * 已在 `:contract` 拆分细粒度网关接口，并保留聚合入口：
    * 新增 `RuntimeInitializer` / `RecordGateway` / `ReportGateway` / `QueryGateway` / `TxtStorageGateway` / `ConfigGateway`
    * `RuntimeGateway` 调整为聚合接口（继承上述子接口）
  * `NativeRuntimeController` 保持实现聚合接口，行为不变
  * `AppContainer` 改为暴露细粒度 gateway getter，同时保留 `runtimeGateway` 兼容入口
  * ViewModel 依赖迁移到最小接口：
    * `DataViewModel` -> `RuntimeInitializer + RecordGateway`
    * `QueryReportViewModel` -> `ReportGateway + QueryGateway`
    * `RecordUseCases/RecordViewModelFactory` -> `RecordGateway + TxtStorageGateway + QueryGateway`
  * 注入链路已同步到 `MainActivity` 与 `TracerScreen`
  * Step 8 全量回归（自动化）通过：
    * `cd apps/tracer_android && ./gradlew.bat :app:assembleDebug`
    * `ctest --test-dir apps/time_tracer/build_fast -R "^time_tracker_android_runtime_tests$" --output-on-failure`
  * 手工烟测状态：
    * 尚未在本次自动化流程中执行真机/模拟器 UI 操作
    * 建议按 `Data -> Report -> Record` 路径补齐手测并记录截图
* **P2 Step 9-14 适配收口完成清单**：
  * 已完成 Stats/Tree 周期能力对齐（`day/week/month/year/recent/range`），并统一为分段数字输入（降低手输格式错误）
  * 已完成 Stats 与 Tree 的功能解耦：
    * `Generate <period> Stats` 仅负责统计结果
    * `Load Project Tree` 仅负责树结构结果
  * 已完成运行时查询模板收敛（Step 12）：
    * `NativeRuntimeController` 引入 `DataQueryRequest` 与 `executeNativeDataQuery(...)`，统一 `nativeQuery` 参数拼装路径
    * 抽取 `normalizePeriodArgument(...)` / `validatePeriodArgument(...)`，去重 stats/tree 重复分支并保持行为不变
  * 已完成 Step 13 测试补强：
    * `test/suites/time_tracer/tests.toml` 为 `days-stats` 六周期命令新增 markdown 关键字段断言（`## Day Duration Stats` / `- **Days**:` / `### Notes`）
    * 新增 `apps/tracer_android/feature-report/src/test/java/com/example/tracer/QueryPeriodArgumentResolverTest.kt`
    * 新增 `apps/tracer_android/feature-report/src/test/java/com/example/tracer/QueryReportViewModelStatsTest.kt`
    * 新增 `apps/tracer_android/app/src/androidTest/java/com/example/tracer/TracerScreenStatsMarkdownRenderTest.kt`

### 弃用/删除 (Deprecated/Removed)

* 迁移 C++ 内核相关改动到 `docs/time_tracer/history/v0.6/v0.6.1.md`

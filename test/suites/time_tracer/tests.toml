# Test scenario configuration (commands, pipeline, data)

# ==============================================================================
#                       RUN CONTROL (EXECUTION)
# ==============================================================================
[run_control]
enable_test_execution = 1
stop_on_failure = 1

# ==============================================================================
#                      PIPELINE CONTROL
# ==============================================================================
[pipeline]
# mode: "ingest" or "staged"
mode = "ingest"

# ==============================================================================
#                 PATH AND DIRECTORY CONFIGURATION
# ==============================================================================
[paths]
test_data_path = "../../data/dates"

# ==============================================================================
#                        LOG ROUTING (OPTIONAL)
# ==============================================================================
[log_routing]

[[log_routing.rules]]
stage = "query-data"
command_prefix = ["query", "data", "tree"]
subdir = "tree"
legacy_name_contains = ["_query_data_tree_"]

[[log_routing.rules]]
stage = "query-data"
command_prefix = ["query", "data", "days-stats"]
subdir = "stats"
legacy_name_contains = ["_query_data_days_stats_"]

# ==============================================================================
#                      COMMAND TABLE (TABLE-DRIVEN)
# ==============================================================================
[[command_groups]]
name = "Query Daily"
stage = "query"
name_template = "Query Daily ({date}) [{fmt}]"
template = ["query", "day", "{date}", "--format", "{fmt}", "--database", "{db_path}"]
matrix = { date = ["20260101", "20260201"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Query Monthly"
stage = "query"
name_template = "Query Monthly ({month}) [{fmt}]"
template = ["query", "month", "{month}", "--format", "{fmt}", "--database", "{db_path}"]
matrix = { month = ["202605", "202606"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Query Weekly"
stage = "query"
name_template = "Query Weekly ({week}) [{fmt}]"
template = ["query", "week", "{week}", "--format", "{fmt}", "--database", "{db_path}"]
matrix = { week = ["2026-W01", "2026-W05"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Query Yearly"
stage = "query"
name_template = "Query Yearly ({year}) [{fmt}]"
template = ["query", "year", "{year}", "--format", "{fmt}", "--database", "{db_path}"]
matrix = { year = ["2025", "2026"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Query Recent"
stage = "query"
name_template = "Query Recent ({days} days) [{fmt}]"
template = ["query", "recent", "{days}", "--format", "{fmt}", "--database", "{db_path}"]
matrix = { days = [7, 10, 15], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Export Daily"
stage = "export"
name_template = "Export Daily ({date}) [{fmt}]"
template = ["export", "day", "{date}", "--format", "{fmt}", "--database", "{db_path}", "--output", "{export_output_dir}"]
matrix = { date = ["20210103", "20260101", "20260102", "20260103", "20260104", "20260105", "20260106", "20260107", "20260108", "20260109", "202601010", "20260201"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Export Monthly"
stage = "export"
name_template = "Export Monthly ({month}) [{fmt}]"
template = ["export", "month", "{month}", "--format", "{fmt}", "--database", "{db_path}", "--output", "{export_output_dir}"]
matrix = { month = ["202605", "202606"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Export Weekly"
stage = "export"
name_template = "Export Weekly ({week}) [{fmt}]"
template = ["export", "week", "{week}", "--format", "{fmt}", "--database", "{db_path}", "--output", "{export_output_dir}"]
matrix = { week = ["2026-W01", "2026-W05"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Export Yearly"
stage = "export"
name_template = "Export Yearly ({year}) [{fmt}]"
template = ["export", "year", "{year}", "--format", "{fmt}", "--database", "{db_path}", "--output", "{export_output_dir}"]
matrix = { year = ["2025", "2026"], fmt = ["md", "tex", "typ"] }

[[command_groups]]
name = "Export Recent"
stage = "export"
name_template = "Export Recent ({days} days) [{fmt}]"
template = ["export", "recent", "{days}", "--format", "{fmt}", "--database", "{db_path}", "--output", "{export_output_dir}"]
matrix = { days = [7, 10, 15], fmt = ["md", "tex", "typ"] }

[[commands]]
name = "Version Check"
stage = "version"
args = ["--version"]
expect_exit = 0

# Tree command tests
[[commands]]
name = "Tree Full"
stage = "tree"
args = ["tree", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Tree Roots"
stage = "tree"
args = ["tree", "--roots", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Tree Level 0"
stage = "tree"
args = ["tree", "-l", "0", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Tree Level 1"
stage = "tree"
args = ["tree", "-l", "1", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Tree Level 3"
stage = "tree"
args = ["tree", "-l", "3", "--database", "{db_path}"]
expect_exit = 0

# Query Data command tests
[[commands]]
name = "Query Data Years"
stage = "query-data"
args = ["query", "data", "years", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Months 2026"
stage = "query-data"
args = ["query", "data", "months", "--year", "2026", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Days"
stage = "query-data"
args = ["query", "data", "days", "--year", "2026", "--month", "1", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Search"
stage = "query-data"
args = ["query", "data", "search", "--remark", "meeting", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Search Activity Remark Banana"
stage = "query-data"
args = ["query", "data", "search", "--remark", "banana", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Search Day Remark Betrayal"
stage = "query-data"
args = ["query", "data", "search", "--day-remark", "背叛", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Project Search"
stage = "query-data"
args = ["query", "data", "search", "--project", "study", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Activity Suggest"
stage = "query-data"
args = ["query", "data", "activity-suggest", "--lookback-days", "10", "--top", "5", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Days Stats Day"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "day", "--period-arg", "20260103", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Days Stats Week"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "week", "--period-arg", "2026-W01", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Days Stats Month"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "month", "--period-arg", "202601", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Days Stats Year"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "year", "--period-arg", "2026", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Days Stats Recent"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "recent", "--period-arg", "7", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Days Stats Range"
stage = "query-data"
args = ["query", "data", "days-stats", "--period", "range", "--period-arg", "20260101|20260131", "--top", "5", "--database", "{db_path}"]
expect_exit = 0
expect_stdout_contains = ["## Day Duration Stats", "- **Days**:", "### Notes"]

[[commands]]
name = "Query Data Tree Day"
stage = "query-data"
args = ["query", "data", "tree", "--period", "day", "--period-arg", "20260103", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Week"
stage = "query-data"
args = ["query", "data", "tree", "--period", "week", "--period-arg", "2026-W01", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Month"
stage = "query-data"
args = ["query", "data", "tree", "--period", "month", "--period-arg", "202601", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Year"
stage = "query-data"
args = ["query", "data", "tree", "--period", "year", "--period-arg", "2026", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Recent"
stage = "query-data"
args = ["query", "data", "tree", "--period", "recent", "--period-arg", "7", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Range"
stage = "query-data"
args = ["query", "data", "tree", "--period", "range", "--period-arg", "20260101|20260131", "--database", "{db_path}"]
expect_exit = 0

[[commands]]
name = "Query Data Tree Day Level 1"
stage = "query-data"
args = ["query", "data", "tree", "--period", "day", "--period-arg", "20260103", "--level", "1", "--database", "{db_path}"]
expect_exit = 0
